(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const C=e=>e.classList.toggle("card__like-button_is-active"),$=e=>{e.remove()},F=e=>{e.textContent=+e.textContent+1},N=e=>{e.textContent=e.textContent-1},X=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,ownerID:r})=>{const s=X(),i=s.querySelector(".card__like-button"),d=s.querySelector(".card__control-button_type_delete"),v=s.querySelector(".card__image"),B=s.querySelector(".card__like-count");s.id=e._id,v.src=e.link,v.alt=e.name,s.querySelector(".card__title").textContent=e.name,B.textContent=e.likes.length,o&&i.addEventListener("click",()=>o({likeButton:i,cardLikeCounter:B})),n&&d.addEventListener("click",()=>n(s)),t&&v.addEventListener("click",()=>t({name:e.name,link:e.link}));let A=!1;for(let b=0;b<e.likes.length;b++)if(e.likes[b]._id===r){A=!0;break}return A&&C(i),e.owner._id!==r&&d.remove(),s},D=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",D)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",D)},V=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"1eb58ff4-b856-4fff-b386-cf8a6558a1fb","Content-Type":"application/json"}},a=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),Y=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(a),W=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(a),Z=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(a),ee=({avatar:e})=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(a),te=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(a),H=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(a),j=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(a),oe=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.classList.add(n.errorClass),r.textContent=o},J=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},re=(e,t,o)=>{t.validity.patternMismatch&&t.dataset.errorMessage?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?J(e,t,o):oe(e,t,t.validationMessage,o)},ne=e=>e.some(t=>!t.validity.valid),z=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.setAttribute("disabled",!0)},se=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.removeAttribute("disabled")},P=(e,t,o)=>{ne(e)?z(t,o):se(t,o)},ce=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);P(o,n,t),o.forEach(r=>{r.addEventListener("input",function(){re(e,r,t),P(o,n,t)})})},q=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{J(e,r,t),r.setCustomValidity("")}),z(n,t)},ie=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",function(n){n.preventDefault()}),ce(o,e)})},h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ie(h);const R=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),S=L.querySelector(".popup__form"),K=S.querySelector(".popup__input_type_name"),G=S.querySelector(".popup__input_type_description"),g=document.querySelector(".popup_type_new-card"),f=g.querySelector(".popup__form"),ae=f.querySelector(".popup__input_type_card-name"),le=f.querySelector(".popup__input_type_url"),x=document.querySelector(".popup_type_image"),M=x.querySelector(".popup__image"),ue=x.querySelector(".popup__caption"),pe=document.querySelector(".header__logo"),de=document.querySelector(".profile__edit-button"),me=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),w=document.querySelector(".popup_type_edit-avatar"),y=w.querySelector(".popup__form"),fe=y.querySelector(".popup__input"),T=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),p=document.querySelector(".popup_type_info"),_e=p.querySelector(".popup__title"),l=p.querySelector(".popup__info"),ye=p.querySelector(".popup__text"),U=p.querySelector(".popup__list"),m=(e,t)=>{const n=document.querySelector("#popup-info-definition-template").content.cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=t,n},he=e=>{const o=document.querySelector("#popup-info-user-preview-template").content.cloneNode(!0);return o.querySelector(".popup__list-item_type_badge").textContent=e,o},Se=()=>{W().then(e=>{l.innerHTML="",U.innerHTML="",_e.textContent="Статистика пользователей",ye.textContent="Все пользователи";const t=new Map;e.forEach(o=>{const n=o.owner.name,r=t.get(n)||0;t.set(n,r+1)}),l.append(m("Всего карточек:",e.length)),l.append(m("Первая создана:",T(new Date(e[e.length-1].createdAt)))),l.append(m("Последняя создана:",T(new Date(e[0].createdAt)))),l.append(m("Всего пользователей:",t.size)),l.append(m("Максимум карточек от одного:",Math.max(...t.values()))),Array.from(t.keys()).forEach(o=>{const n=he(o);U.append(n)}),_(p)}).catch(e=>{console.log(e)})},Q=({name:e,link:t})=>{M.src=t,M.alt=e,ue.textContent=e,_(x)},ve=e=>{e.preventDefault();const o=e.target.querySelector(".popup__button"),n=o.textContent;o.disabled=!0,o.textContent="Сохранение...",Z({name:K.value,about:G.value}).then(r=>{k.textContent=r.name,E.textContent=r.about,u(L)}).catch(r=>{console.log(r)}).finally(()=>{o.disabled=!1,o.textContent=n})},be=e=>{e.preventDefault();const o=e.target.querySelector(".popup__button"),n=o.textContent;o.disabled=!0,o.textContent="Сохранение...",ee({avatar:fe.value}).then(r=>{I.style.backgroundImage=`url(${r.avatar})`,u(w)}).catch(r=>{console.log(r)}).finally(()=>{o.disabled=!1,o.textContent=n})},Ce=e=>{e.preventDefault();const o=e.target.querySelector(".popup__button"),n=o.textContent;o.disabled=!0,o.textContent="Создание...",te({name:ae.value,link:le.value}).then(r=>{R.prepend(O(r,{onPreviewPicture:Q,onLikeIcon:({likeButton:s,cardLikeCounter:i})=>{const d=C(s);j(r._id,!d),d?F(i):N(i)},onDeleteCard:s=>{H(s.id),$(s)},ownerID:r.owner._id})),u(g)}).catch(r=>{console.log(r)}).finally(()=>{o.disabled=!1,o.textContent=n})};S.addEventListener("submit",ve);f.addEventListener("submit",Ce);y.addEventListener("submit",be);pe.addEventListener("click",Se);V(p);de.addEventListener("click",()=>{K.value=k.textContent,G.value=E.textContent,q(S,h),_(L)});I.addEventListener("click",()=>{y.reset(),q(y,h),_(w)});me.addEventListener("click",()=>{f.reset(),q(f,h),_(g)});const qe=document.querySelectorAll(".popup");qe.forEach(e=>{V(e)});Promise.all([W(),Y()]).then(([e,t])=>{e.forEach(o=>{R.append(O(o,{onPreviewPicture:Q,onLikeIcon:({likeButton:n,cardLikeCounter:r})=>{const s=C(n);j(o._id,!s),s?F(r):N(r)},onDeleteCard:n=>{H(n.id),$(n)},ownerID:t._id}))}),k.textContent=t.name,E.textContent=t.about,I.style.backgroundImage=`url(${t.avatar})`}).catch(e=>{console.log(e)});
