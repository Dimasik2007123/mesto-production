(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const q=e=>e.classList.toggle("card__like-button_is-active"),Y=e=>{e.remove()},N=e=>{e.textContent=+e.textContent+1},D=e=>{e.textContent=e.textContent-1},Z=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,ownerID:r})=>{const s=Z(),a=s.querySelector(".card__like-button"),m=s.querySelector(".card__control-button_type_delete"),b=s.querySelector(".card__image"),A=s.querySelector(".card__like-count");s.id=e._id,b.src=e.link,b.alt=e.name,s.querySelector(".card__title").textContent=e.name,A.textContent=e.likes.length,o&&a.addEventListener("click",()=>o({likeButton:a,cardLikeCounter:A})),n&&m.addEventListener("click",()=>n(s)),t&&b.addEventListener("click",()=>t({name:e.name,link:e.link}));let M=!1;for(let C=0;C<e.likes.length;C++)if(e.likes[C]._id===r){M=!0;break}return M&&q(a),e.owner._id!==r&&m.remove(),s},W=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");l(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",W)},l=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",W)},V=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{l(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&l(e)})},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"1eb58ff4-b856-4fff-b386-cf8a6558a1fb","Content-Type":"application/json"}},i=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ee=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(i),H=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(i),te=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(i),oe=({avatar:e})=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(i),re=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(i),ne=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(i),j=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(i),se=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.classList.add(n.errorClass),r.textContent=o},J=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},ce=(e,t,o)=>{t.validity.patternMismatch&&t.dataset.errorMessage?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?J(e,t,o):se(e,t,t.validationMessage,o)},ae=e=>e.some(t=>!t.validity.valid),R=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.setAttribute("disabled",!0)},le=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.removeAttribute("disabled")},P=(e,t,o)=>{ae(e)?R(t,o):le(t,o)},ie=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);P(o,n,t),o.forEach(r=>{r.addEventListener("input",function(){ce(e,r,t),P(o,n,t)})})},L=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{J(e,r,t),r.setCustomValidity("")}),R(n,t)},ue=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",function(n){n.preventDefault()}),ie(o,e)})},S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ue(S);const z=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),v=g.querySelector(".popup__form"),K=v.querySelector(".popup__input_type_name"),G=v.querySelector(".popup__input_type_description"),x=document.querySelector(".popup_type_new-card"),y=x.querySelector(".popup__form"),pe=y.querySelector(".popup__input_type_card-name"),de=y.querySelector(".popup__input_type_url"),k=document.querySelector(".popup_type_image"),U=k.querySelector(".popup__image"),me=k.querySelector(".popup__caption"),fe=document.querySelector(".header__logo"),_e=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),w=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_remove-card"),he=B.querySelector(".popup__form");let _=null;const T=document.querySelector(".popup_type_edit-avatar"),h=T.querySelector(".popup__form"),Se=h.querySelector(".popup__input"),$=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),d=document.querySelector(".popup_type_info"),ve=d.querySelector(".popup__title"),u=d.querySelector(".popup__info"),be=d.querySelector(".popup__text"),F=d.querySelector(".popup__list"),f=(e,t)=>{const n=document.querySelector("#popup-info-definition-template").content.cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=t,n},Ce=e=>{const o=document.querySelector("#popup-info-user-preview-template").content.cloneNode(!0);return o.querySelector(".popup__list-item_type_badge").textContent=e,o},Q=e=>{_=e,_.dataset.id=e.id,p(B)},qe=e=>{e.preventDefault();const o=e.target.querySelector(".popup__button"),n=o.textContent;o.disabled=!0,o.textContent="Удаление...",ne(_.dataset.id).then(()=>{Y(_),l(B),_=null}).catch(r=>{console.log(r)}).finally(()=>{o.disabled=!1,o.textContent=n})},Le=()=>{H().then(e=>{u.innerHTML="",F.innerHTML="",ve.textContent="Статистика пользователей",be.textContent="Все пользователи";const t=new Map;e.forEach(o=>{const n=o.owner.name,r=t.get(n)||0;t.set(n,r+1)}),u.append(f("Всего карточек:",e.length)),u.append(f("Первая создана:",$(new Date(e[e.length-1].createdAt)))),u.append(f("Последняя создана:",$(new Date(e[0].createdAt)))),u.append(f("Всего пользователей:",t.size)),u.append(f("Максимум карточек от одного:",Math.max(...t.values()))),Array.from(t.keys()).forEach(o=>{const n=Ce(o);F.append(n)}),p(d)}).catch(e=>{console.log(e)})},X=({name:e,link:t})=>{U.src=t,U.alt=e,me.textContent=e,p(k)},ge=e=>{e.preventDefault();const o=e.target.querySelector(".popup__button"),n=o.textContent;o.disabled=!0,o.textContent="Сохранение...",te({name:K.value,about:G.value}).then(r=>{E.textContent=r.name,I.textContent=r.about,l(g)}).catch(r=>{console.log(r)}).finally(()=>{o.disabled=!1,o.textContent=n})},xe=e=>{e.preventDefault();const o=e.target.querySelector(".popup__button"),n=o.textContent;o.disabled=!0,o.textContent="Сохранение...",oe({avatar:Se.value}).then(r=>{w.style.backgroundImage=`url(${r.avatar})`,l(T)}).catch(r=>{console.log(r)}).finally(()=>{o.disabled=!1,o.textContent=n})},ke=e=>{e.preventDefault();const o=e.target.querySelector(".popup__button"),n=o.textContent;o.disabled=!0,o.textContent="Создание...",re({name:pe.value,link:de.value}).then(r=>{z.prepend(O(r,{onPreviewPicture:X,onLikeIcon:({likeButton:s,cardLikeCounter:a})=>{const m=q(s);j(r._id,!m),m?N(a):D(a)},onDeleteCard:s=>{Q(s)},ownerID:r.owner._id})),l(x)}).catch(r=>{console.log(r)}).finally(()=>{o.disabled=!1,o.textContent=n})};v.addEventListener("submit",ge);y.addEventListener("submit",ke);h.addEventListener("submit",xe);fe.addEventListener("click",Le);V(d);he.addEventListener("submit",qe);_e.addEventListener("click",()=>{K.value=E.textContent,G.value=I.textContent,L(v,S),p(g)});w.addEventListener("click",()=>{h.reset(),L(h,S),p(T)});ye.addEventListener("click",()=>{y.reset(),L(y,S),p(x)});const Ee=document.querySelectorAll(".popup");Ee.forEach(e=>{V(e)});Promise.all([H(),ee()]).then(([e,t])=>{e.forEach(o=>{z.append(O(o,{onPreviewPicture:X,onLikeIcon:({likeButton:n,cardLikeCounter:r})=>{const s=q(n);j(o._id,!s),s?N(r):D(r)},onDeleteCard:n=>{Q(n)},ownerID:t._id}))}),E.textContent=t.name,I.textContent=t.about,w.style.backgroundImage=`url(${t.avatar})`}).catch(e=>{console.log(e)});
